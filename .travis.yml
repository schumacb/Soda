
language: cpp

sudo: required

services:
  - docker

compiler:
  - gcc

branches:
  only:
  - master
  - testing
  - travis-ci-test

addons:
  apt:
    packages:
      - gcc-5
      - g++-5
      - cmake
      - ninja-build
      - qt5-default
      - libopencv-dev
    sources:
      - ubuntu-toolchain-r-test

before_install:
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 50
    - export SOURCE_DIR=${TRAVIS_BUILD_DIR}
    - export BUILD_DIR=${TRAVIS_BUILD_DIR}/build

install:
  # Installing lcov
  - cd ${HOME}
  - wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.13.orig.tar.gz
  - tar xf lcov_1.13.orig.tar.gz
  - cd lcov-1.13/
  - sudo make install
  - cd ${SOURCE_DIR}
  # Checking versions
  - lcov --version
  - g++ --version
  - qmake -v
  - pkg-config --libs opencv

script: ./run_build.sh

after_success:
  # Creating report
  - cd ${TRAVIS_BUILD_DIR}
  - lcov --directory . --capture --output-file coverage.info # capture coverage info
  - lcov --remove coverage.info '/usr/*' --output-file coverage.info # filter out system
  - lcov --remove coverage.info 'moc_*' --output-file coverage.info # filter out generated code
  - lcov --remove coverage.info 'catch.hpp' --output-file coverage.info # filter out catch library
  - lcov --list coverage.info #debug info
  # Uploading report to CodeCov
  - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"

notifications:
  email:
    - Bastian.Schumacher@gmx.de

env:
  global:
  - LANG="en_US.UTF-8"
